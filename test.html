<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draft Survey Assistant Officer</title>
    <link rel="icon" href="https://raw.githubusercontent.com/wahid7ark/wahid7ark.github.io/refs/heads/main/icon.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        /* ================== GLOBAL & BODY ================== */
        body {
            margin: 0;
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(#03121c, #000814);
            color: white;
            text-align: center;
        }

        h1 {
            margin: 12px 0;
            letter-spacing: 2px;
        }

        img#barge {
            width: 95%;
            max-width: 720px;
            border-radius: 14px;
            box-shadow: 0 0 25px #00eaff55;
        }

        .container {
            display: grid;
            gap: 14px;
            padding: 14px;
        }

        .card {
            background: #021019;
            padding: 15px;
            border-radius: 14px;
            box-shadow: 0 0 15px #00ffd533 inset;
        }

        h3 {
            margin: 10px 0;
        }

        h4 {
            margin: 8px 0 4px 0;
            color: #7fd3ff;
        }

        .row {
            display: flex;
            gap: 8px;
        }

        input {
            width: 92%;
            padding: 11px;
            margin: 6px;
            border-radius: 8px;
            border: none;
            background: #000c14;
            color: white;
            text-align: center;
            font-size: 15px;
        }

        button {
            padding: 12px;
            margin: 8px;
            border: none;
            border-radius: 12px;
            background: #0a2a3a;
            color: #9fe9ff;
            font-weight: bold;
            font-size: 15px;
            box-shadow: 0 0 10px #00eaff33 inset;
            cursor: pointer;
        }

        #exportBtn {
            background: #00ff88;
            color: black;
        }

        #result {
            font-size: 18px;
            color: #00ffd5;
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
        }

        #process {
            text-align: left;
            white-space: pre-line;
            font-size: 13px;
            color: #bffcf3;
            margin-top: 12px;
        }

        /* MODE TOGGLE */
        .modeToggle {
            margin: 12px 0;
        }

        select {
            padding: 8px;
            border-radius: 8px;
            border: none;
            background: #001122;
            color: #7fd3ff;
            font-weight: bold;
            cursor: pointer;
        }

        /* ABOUT MODAL */
        #aboutBox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000c;
            display: none;
        }

        #aboutContent {
            background: #021019;
            margin: 15% auto;
            padding: 20px;
            width: 85%;
            border-radius: 12px;
            position: relative;
        }

        #closeAbout {
            position: absolute;
            right: 18px;
            top: 12px;
            font-size: 20px;
            color: #7feaff;
            cursor: pointer;
        }

        /* FOOTER */
        footer {
            padding: 12px;
            font-size: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        .coder {
            color: #7feaff;
            font-size: 12px;
            margin-right: 6px;
        }

        .copy {
            color: #00ff7b;
        }

        .year {
            color: #999;
        }

        .aboutMini {
            padding: 3px 10px;
            font-size: 11px;
            background: transparent;
            border: 1px solid #00eaff;
            color: #7feaff;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .material-icons {
            vertical-align: middle;
        }

        /* GRAPHICS & ANIMATIONS */
        #chartContainer {
            width: 100%;
            height: 150px;
            margin-top: 8px;
        }

        @media (min-width: 768px) {
            #result {
                max-height: 400px;
            }
        }
    </style>
</head>

<body>
    <!-- ================= AUDIO ================= -->
    <audio autoplay loop>
        <source src="https://raw.githubusercontent.com/wahid7ark/wahid7ark.github.io/main/audio.mp3" type="audio/mpeg">
    </audio>

    <h1>BG ARK CARNELIAN</h1>
    <img id="barge" src="https://raw.githubusercontent.com/wahid7ark/wahid7ark.github.io/main/photo.jpg">

    <!-- ================= MODE TOGGLE ================= -->
    <div class="container">
        <div class="modeToggle card">
            <label for="modeSelect">Mode:</label>
            <select id="modeSelect">
                <option value="surveyor">Surveyor</option>
                <option value="navalArch">Naval Arch</option>
                <option value="supervisor">Supervisor ðŸ”’</option>
            </select>
        </div>

        <!-- ================= SURVEY INPUTS ================= -->
        <div class="card" id="initialSurvey">
            <h3>INITIAL SURVEY</h3>
            <h4>Forward</h4>
            <div class="row">
                <input id="ifp" placeholder="Port (m)">
                <input id="ifs" placeholder="Stbd (m)">
            </div>
            <h4>Midship</h4>
            <div class="row">
                <input id="imp" placeholder="Port (m)">
                <input id="ims" placeholder="Stbd (m)">
            </div>
            <h4>Aft</h4>
            <div class="row">
                <input id="iap" placeholder="Port (m)">
                <input id="ias" placeholder="Stbd (m)">
            </div>
            <h4>Density</h4>
            <input id="densI" value="1.025" placeholder="1.025">
        </div>

        <div class="card" id="finalSurvey">
            <h3>FINAL SURVEY</h3>
            <h4>Forward</h4>
            <div class="row">
                <input id="ffp" placeholder="Port (m)">
                <input id="ffs" placeholder="Stbd (m)">
            </div>
            <h4>Midship</h4>
            <div class="row">
                <input id="fmp" placeholder="Port (m)">
                <input id="fms" placeholder="Stbd (m)">
            </div>
            <h4>Aft</h4>
            <div class="row">
                <input id="fap" placeholder="Port (m)">
                <input id="fas" placeholder="Stbd (m)">
            </div>
            <h4>Density</h4>
            <input id="densF" value="1.025" placeholder="1.025">
        </div>

        <!-- ================= BUTTONS ================= -->
        <button onclick="calculate()">CALCULATE</button>
        <button id="exportBtn" onclick="exportReport()">EXPORT REPORT</button>

        <!-- ================= RESULT & GRAPH ================= -->
        <div class="card" id="resultCard">
            <div id="result">Awaiting Calculation...</div>
            <div id="process"></div>
            <canvas id="chartContainer"></canvas>
            <div id="formulaAnim"></div>
        </div>
    </div>

    <!-- ================= ABOUT MODAL ================= -->
    <div id="aboutBox">
        <div id="aboutContent">
            <span id="closeAbout" class="material-icons" onclick="aboutBox.style.display='none'">close</span>
            <h3>Draft Survey Assistant Officer</h3>
            <p>Survei draft tongkang menggunakan Metode Quarter Mean Draft, koreksi LCF, koreksi trim, koreksi densitas, dan interpolasi hidrostatik.</p>
            <p><a href="https://github.com/wahid7ark/wahid7ark.github.io/blob/main/carnelian.html" target="_blank">Profil Pengembang</a></p>
        </div>
    </div>

    <!-- ================= FOOTER ================= -->
    <footer>
        <span class="coder">Coder: Mr. Wolf (ARK DAN)</span>
        <span class="copy">Â©</span><span class="year" id="year"></span>
        <button class="aboutMini" onclick="showAbout()"><span class="material-icons">info</span>ABOUT</button>
    </footer>

    <!-- ================= SCRIPT ================= -->
    <script>
        document.getElementById("year").innerText = new Date().getFullYear();

        // ================== HYDROSTATIC TABLE PLACEHOLDER ==================
        const hydroTable = []; // user akan mengisi: draft, disp, tpc, lcf, mct, kml, kmt, vcb

        // ================== UTILITY FUNCTIONS ==================
        function num(x) { return parseFloat(String(x).replace(",", ".") || 0); }
        function mean(p, s) { return (num(p) + num(s)) / 2; }
        function qmd(f, m, a) { return (f + a + 6 * m) / 8; }

        function interpolate(draft) {
            if (hydroTable.length < 2) return null;
            for (let i = 0; i < hydroTable.length - 1; i++) {
                let a = hydroTable[i], b = hydroTable[i + 1];
                if (draft >= a.draft && draft <= b.draft) {
                    let r = (draft - a.draft) / (b.draft - a.draft);
                    return {
                        disp: a.disp + (b.disp - a.disp) * r,
                        tpc: a.tpc + (b.tpc - a.tpc) * r,
                        lcf: a.lcf + (b.lcf - a.lcf) * r,
                        mct: a.mct + (b.mct - a.mct) * r,
                        vcb: a.vcb + (b.vcb - a.vcb) * r,
                        kml: a.kml + (b.kml - a.kml) * r,
                        kmt: a.kmt + (b.kmt - a.kmt) * r
                    };
                }
            }
            return null;
        }

        // ================== GET SURVEY DATA ==================
        function getSurvey(prefix, mode) {
            let F = mean(document.getElementById(prefix + "fp").value, document.getElementById(prefix + "fs").value);
            let M = mean(document.getElementById(prefix + "mp").value, document.getElementById(prefix + "ms").value);
            let A = mean(document.getElementById(prefix + "ap").value, document.getElementById(prefix + "as").value);
            let Q = qmd(F, M, A);
            let hydro = interpolate(Q);
            if (!hydro) { alert("Draft outside hydrostatic table"); return; }
            let density = num(document.getElementById(prefix == "i" ? "densI" : "densF").value);

            // ================== SURVEYOR MODE ==================
            if (mode === "surveyor") {
                let disp = hydro.disp * density / 1.025;
                return { disp, draft: Q, trim: A - F, hydro };
            }

            // ================== NAVAL ARCH MODE ==================
            else if (mode === "navalArch") {
                let trim = A - F;
                let LBP = 92.0;
                let draftLCF = Q + (trim * hydro.lcf / LBP);
                let hydroLCF = interpolate(draftLCF);
                if (!hydroLCF) return null;

                // ================== TRIM & DENSITY CORRECTION ==================
                let trimCorr = (trim * 100 * hydroLCF.tpc * hydroLCF.lcf) / hydroLCF.mct;
                let dispCorrected = (hydroLCF.disp + trimCorr) * density / 1.025;

                return { disp: dispCorrected, draft: Q, trim, hydro: hydroLCF };
            }
        }

        // ================== CALCULATION ==================
        function calculate() {
            let mode = document.getElementById("modeSelect").value;

            if (mode === "supervisor") {
                let pwd = prompt("Enter Supervisor password:");
                if (pwd === "1234") {
                    alert("Under development");
                } else {
                    alert("Access denied");
                }
                return;
            }

            let I = getSurvey("i", mode);
            let F = getSurvey("f", mode);
            if (!I || !F) return;

            let cargo = F.disp - I.disp;
            document.getElementById("result").innerHTML = `<b>CARGO WEIGHT: ${cargo.toFixed(2)} MT</b>`;

            document.getElementById("process").innerText =
                `INITIAL DISPLACEMENT : ${I.disp.toFixed(2)} MT\n` +
                `FINAL DISPLACEMENT   : ${F.disp.toFixed(2)} MT\n\n` +
                `INITIAL DRAFT : ${I.draft.toFixed(3)} m\n` +
                `FINAL DRAFT   : ${F.draft.toFixed(3)} m\n\n` +
                `TPC : ${F.hydro.tpc.toFixed(3)}\nLCF : ${F.hydro.lcf.toFixed(3)}\n` +
                `MCT : ${F.hydro.mct.toFixed(2)}\nVCB : ${F.hydro.vcb.toFixed(3)}\n` +
                `KML : ${F.hydro.kml.toFixed(2)}\nKMT : ${F.hydro.kmt.toFixed(2)}`;

            animateFormula();
            drawChart(I, F);
        }

        // ================== EXPORT REPORT ==================
        function exportReport() {
            let text = document.getElementById("result").innerText + "\n\n" + document.getElementById("process").innerText;
            let blob = new Blob([text], { type: "text/plain" });
            let a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = "DraftSurvey_Report.txt";
            a.click();
        }

        // ================== FORMULA ANIMATION ==================
        function animateFormula() {
            let formulaDiv = document.getElementById("formulaAnim");
            formulaDiv.innerHTML = '';
            let formula = "QM = (F + A + 6*M)/8";
            for (let i = 0; i < formula.length; i++) {
                let span = document.createElement("span");
                span.innerText = formula[i];
                span.style.animation = `fadeIn 1s ease ${i*0.05}s forwards`;
                span.style.opacity = 0;
                formulaDiv.appendChild(span);
            }
        }

        // ================== CHART ==================
        function drawChart(I, F) {
            const canvas = document.getElementById("chartContainer");
            const ctx = canvas.getContext("2d");
            canvas.width = canvas.clientWidth;
            canvas.height = canvas.clientHeight;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const margin = 20;
            const w = canvas.width - margin * 2;
            const h = canvas.height - margin * 2;
            const start = I.disp;
            const end = F.disp;
            const maxDisp = Math.max(I.disp, F.disp);
            const minDisp = Math.min(I.disp, F.disp);

            // bar
            ctx.fillStyle = "#00ffd5";
            const barH = h * (end - minDisp) / (maxDisp - minDisp);
            ctx.fillRect(w/2 - 15, h - barH, 30, barH);

            // baseline
            ctx.strokeStyle = "#7fd3ff33";
            ctx.beginPath();
            ctx.moveTo(0, h);
            ctx.lineTo(w, h);
            ctx.stroke();
        }

        // ================== ABOUT ==================
        function showAbout() { aboutBox.style.display = "block"; }

        // ================== ANIMATION KEYFRAME ==================
        const style = document.createElement('style');
        style.innerHTML = `
        @keyframes fadeIn {
            from {opacity:0; transform: translateY(-5px);}
            to {opacity:1; transform: translateY(0);}
        }`;
        document.head.appendChild(style);
    </script>
</body>

</html>
