<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Magnetic Variation – WMM2025 (NOAA)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  background:#0b1217;
  color:#e6f2ff;
  font-family:Segoe UI,Roboto,Arial,sans-serif;
}
.container{
  max-width:720px;
  margin:auto;
  padding:20px;
}
h1{font-size:22px;margin-bottom:10px}
label{display:block;margin-top:12px;font-size:14px}
input{
  width:100%;
  padding:10px;
  margin-top:4px;
  background:#121c24;
  border:1px solid #243443;
  color:#e6f2ff;
  border-radius:4px;
}
button{
  margin-top:16px;
  width:100%;
  padding:12px;
  background:#1f6feb;
  border:none;
  color:#fff;
  font-size:15px;
  border-radius:4px;
  cursor:pointer;
}
.result{
  margin-top:20px;
  padding:14px;
  background:#101820;
  border:1px solid #243443;
  border-radius:4px;
  font-size:15px;
  line-height:1.5;
}
.footer{
  margin-top:30px;
  font-size:12px;
  color:#9fb3c8;
  text-align:center;
}
</style>
</head>
<body>
<div class="container">
<h1>Magnetic Variation – WMM2025</h1>

<label>Latitude (° decimal, N + / S −)</label>
<input id="lat" placeholder="-3.75">

<label>Longitude (° decimal, E + / W −)</label>
<input id="lon" placeholder="115.65">

<label>Date (UTC)</label>
<input id="date" type="date">

<button onclick="calc()">Calculate</button>

<div id="out" class="result" style="display:none"></div>

<div class="footer">
Model: World Magnetic Model 2025 (NOAA)<br>
For marine navigation – sea level assumption
</div>
</div>

<script>
/* ===============================
   WMM2025 – NOAA Reference Port
   =============================== */

/* WGS84 */
const a = 6378.137;
const b = 6356.7523142;
const re = 6371.2;

/* Max degree */
const nmax = 12;

/* Gauss coefficients (WMM2025) */
const gnm = [
[0],
[-29404.8, -1450.9],
[-2499.6, 2982.0, 1677.0],
[1363.9, -2381.0, 1236.2, 525.7],
[903.1, 809.4, 86.2, -309.4, 48.0],
[-234.4, 363.1, 187.8, -140.7, -151.2, 13.7],
[65.9, 65.6, 73.0, -121.5, -36.2, 13.5, -64.7],
[80.6, -76.8, -8.3, 56.5, 15.8, 6.4, -7.2, 9.8],
[23.6, 9.8, -17.5, -0.4, -21.1, 15.3, 13.7, -16.5, -0.3],
[5.0, 8.2, 2.9, -1.4, -1.1, -13.3, 1.1, 8.9, -9.3, -11.9],
[-1.9, -6.2, -0.1, 1.7, -0.9, 0.6, -0.9, 1.9, 1.4, -2.4, -3.9],
[3.0, -1.4, -2.5, 2.4, -0.9, 0.3, -0.7, -0.1, 1.4, -0.6, 0.2, 3.1],
[-2.0, -0.1, 0.5, 1.3, -1.2, 0.7, 0.3, 0.5, -0.3, -0.4, -0.3, -0.2, -0.5]
];

const hnm = [
[0],
[0, 4652.5],
[0, -2991.6, -734.6],
[0, -82.2, 241.8, -543.4],
[0, 282.0, -158.4, 199.8, -349.7],
[0, 47.7, 208.4, -121.3, 32.2, 99.1],
[0, -19.1, 25.0, 52.7, -64.4, 9.0, 68.1],
[0, -51.4, -16.8, 2.3, 23.5, -2.2, -27.2, -1.9],
[0, 8.4, -15.3, 12.8, -11.8, 14.9, 3.6, -6.9, 2.8],
[0, -23.3, 11.1, 9.8, -5.1, -6.2, 7.8, 0.4, -1.5, 9.7],
[0, 3.4, -0.2, 3.5, 4.8, -8.6, -0.1, -4.2, -3.4, -0.1, -8.8],
[0, -0.0, 2.6, -0.5, -0.4, 0.6, -0.2, -1.7, -1.0, -0.6, -0.8, -0.1],
[0, -1.2, 0.5, 1.3, -1.8, 0.1, 0.7, -0.1, 0.6, 0.2, -0.9, 0.0, 0.5]
];

function decimalYear(date){
  const y = date.getUTCFullYear();
  const start = Date.UTC(y,0,1);
  const end = Date.UTC(y+1,0,1);
  return y + (date.getTime()-start)/(end-start);
}

function calc(){
  const lat = parseFloat(latEl.value);
  const lon = parseFloat(lonEl.value);
  if(isNaN(lat)||isNaN(lon)) return;

  const date = dateEl.value ? new Date(dateEl.value+"T00:00:00Z") : new Date();
  const t = decimalYear(date) - 2025.0;

  const phi = lat*Math.PI/180;
  const lam = lon*Math.PI/180;

  const sinp = Math.sin(phi);
  const cosp = Math.cos(phi);

  const e2 = (a*a-b*b)/(a*a);
  const N = a/Math.sqrt(1-e2*sinp*sinp);

  const r = Math.sqrt(
    (N*cosp)*(N*cosp) +
    (N*(1-e2)*sinp)*(N*(1-e2)*sinp)
  );

  const theta = Math.PI/2 - Math.atan((N*(1-e2)*sinp)/(N*cosp));

  let Br=0,Bt=0,Bp=0;

  for(let n=1;n<=nmax;n++){
    for(let m=0;m<=n;m++){
      const P = Math.pow(Math.cos(theta),m);
      const factor = Math.pow(re/r,n+2);
      const cosml = Math.cos(m*lam);
      const sinml = Math.sin(m*lam);
      const g = gnm[n][m];
      const h = hnm[n][m];
      Br += factor*(n+1)*(g*cosml+h*sinml)*P;
      Bt -= factor*(g*cosml+h*sinml)*P;
      if(m>0) Bp += factor*m*(h*cosml-g*sinml)*P/Math.sin(theta);
    }
  }

  const X = -Bt;
  const Y = Bp;
  const decl = Math.atan2(Y,X)*180/Math.PI;

  out.style.display="block";
  out.innerHTML = `
<b>Magnetic Variation</b><br>
${Math.abs(decl).toFixed(2)}° ${decl>=0?"E":"W"}<br><br>
Epoch: ${decimalYear(date).toFixed(3)}<br>
Model: WMM2025 (NOAA)
`;
}

const latEl = document.getElementById("lat");
const lonEl = document.getElementById("lon");
const dateEl = document.getElementById("date");
const out = document.getElementById("out");
</script>
</body>
</html>
