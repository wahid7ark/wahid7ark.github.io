<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draft Survey Assistant Officer</title>
    <link rel="icon" href="https://raw.githubusercontent.com/wahid7ark/wahid7ark.github.io/refs/heads/main/icon.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <audio autoplay loop>
        <source src="https://raw.githubusercontent.com/wahid7ark/wahid7ark.github.io/main/audio.mp3" type="audio/mpeg">
    </audio>

    <h1>BG ARK CARNELIAN</h1>
    <img id="barge" src="https://raw.githubusercontent.com/wahid7ark/wahid7ark.github.io/main/photo.jpg">

    <div class="container">

        <!-- INITIAL SURVEY -->
        <div class="card">
            <h3>INITIAL SURVEY</h3>
            <h4>Forward</h4>
            <div class="row">
                <input id="ifp" placeholder="Port (m)">
                <input id="ifs" placeholder="Stbd (m)">
            </div>
            <h4>Midship</h4>
            <div class="row">
                <input id="imp" placeholder="Port (m)">
                <input id="ims" placeholder="Stbd (m)">
            </div>
            <h4>Aft</h4>
            <div class="row">
                <input id="iap" placeholder="Port (m)">
                <input id="ias" placeholder="Stbd (m)">
            </div>
            <h4>Density</h4>
            <input id="densI" value="1.025" placeholder="1.025">
        </div>

        <!-- FINAL SURVEY -->
        <div class="card">
            <h3>FINAL SURVEY</h3>
            <h4>Forward</h4>
            <div class="row">
                <input id="ffp" placeholder="Port (m)">
                <input id="ffs" placeholder="Stbd (m)">
            </div>
            <h4>Midship</h4>
            <div class="row">
                <input id="fmp" placeholder="Port (m)">
                <input id="fms" placeholder="Stbd (m)">
            </div>
            <h4>Aft</h4>
            <div class="row">
                <input id="fap" placeholder="Port (m)">
                <input id="fas" placeholder="Stbd (m)">
            </div>
            <h4>Density</h4>
            <input id="densF" value="1.025" placeholder="1.025">
        </div>

        <button id="calcBtn">CALCULATE</button>
        <button id="exportBtn">EXPORT REPORT</button>

        <div class="card">
            <div id="result">Awaiting Calculation...</div>
            <div id="process"></div>
        </div>

    </div>

    <!-- ABOUT MODAL -->
    <div id="aboutBox">
        <div id="aboutContent">
            <span id="closeAbout" class="material-icons" onclick="aboutBox.style.display='none'">close</span>
            <h3>Draft Survey Assistant Officer</h3>
            <p>Survei draft tongkang menggunakan Metode Quarter Mean Draft, koreksi LCF, koreksi trim, koreksi densitas, dan interpolasi hidrostatik.</p>
            <p><a href="https://github.com/wahid7ark/wahid7ark.github.io/blob/main/carnelian.html" target="_blank">Profil Pengembang</a></p>
        </div>
    </div>

    <footer>
        <span class="coder">Coder: Mr. Wolf (ARK DAN)</span>
        <span class="copy">Â©</span><span class="year" id="year"></span>
        <button class="aboutMini" onclick="showAbout()"><span class="material-icons">info</span>ABOUT</button>
    </footer>

    <!-- Script utama -->
    <script src="script.js"></script>

    <script>
    // Nonaktifkan calculate asli
    if (window.calculate) window.calculate = function() { console.log("Original calculate disabled."); };

    // ================= SURVEYOR PATCH =================
    document.getElementById("calcBtn").addEventListener("click", function () {
        // Ambil input initial
        const iF = parseFloat(document.getElementById("ifp").value) || 0;
        const iM = parseFloat(document.getElementById("imp").value) || 0;
        const iA = parseFloat(document.getElementById("iap").value) || 0;
        const densI = parseFloat(document.getElementById("densI").value) || 1.025;

        // Ambil input final
        const fF = parseFloat(document.getElementById("ffp").value) || 0;
        const fM = parseFloat(document.getElementById("fmp").value) || 0;
        const fA = parseFloat(document.getElementById("fap").value) || 0;
        const densF = parseFloat(document.getElementById("densF").value) || 1.025;

        // Quarter Mean Draft
        const QI = (iF + 6*iM + iA)/8;
        const QF = (fF + 6*fM + fA)/8;

        // TPC Surveyor
        const TPC = 18.69; // bisa diganti sesuai tabel surveyor

        // Displacement dari QMD
        const initialDisp = QI * TPC * 100 * (densI/1.025);
        const finalDisp   = QF * TPC * 100 * (densF/1.025);
        const cargoMT     = finalDisp - initialDisp;

        // Interpolasi LCF, VCB, MCT dari hydroTable
        function interpolateHydro(draft){
            for(let i=0;i<hydroTable.length-1;i++){
                let low = hydroTable[i], up = hydroTable[i+1];
                if(draft >= low.draft && draft <= up.draft){
                    let r = (draft - low.draft)/(up.draft - low.draft);
                    return {
                        lcf: low.lcf + r*(up.lcf - low.lcf),
                        vcb: low.vcb + r*(up.vcb - low.vcb),
                        mct: low.degTrim + r*(up.degTrim - low.degTrim),
                        kml: low.kml + r*(up.kml - low.kml),
                        kmt: low.kmt + r*(up.kmt - low.kmt)
                    };
                }
            }
            let last = hydroTable[hydroTable.length-1];
            return {lcf:last.lcf, vcb:last.vcb, mct:last.degTrim, kml:last.kml, kmt:last.kmt};
        }

        const hydroF = interpolateHydro(QF);

        // Tampilkan hasil
        document.getElementById("result").innerHTML =
            `<b>CARGO WEIGHT:</b> ${cargoMT.toFixed(2)} MT`;

        document.getElementById("process").innerHTML =
            `INITIAL DISPLACEMENT : ${initialDisp.toFixed(2)} MT<br>` +
            `FINAL DISPLACEMENT   : ${finalDisp.toFixed(2)} MT<br><br>` +
            `INITIAL DRAFT : ${QI.toFixed(3)} m<br>` +
            `FINAL DRAFT   : ${QF.toFixed(3)} m<br><br>` +
            `TPC : ${TPC.toFixed(2)}<br>` +
            `LCF : ${hydroF.lcf.toFixed(3)}<br>` +
            `MCT : ${hydroF.mct.toFixed(2)}<br>` +
            `VCB : ${hydroF.vcb.toFixed(3)}<br>` +
            `KML : ${hydroF.kml.toFixed(2)}<br>` +
            `KMT : ${hydroF.kmt.toFixed(2)}`;
    });

    // EXPORT
    document.getElementById("exportBtn").addEventListener("click", function(){
        let text = document.getElementById("result").innerText + "\n\n" + document.getElementById("process").innerText;
        let blob = new Blob([text], {type:"text/plain"});
        let a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "DraftSurvey_Report.txt";
        a.click();
    });
    </script>
</body>
</html>
